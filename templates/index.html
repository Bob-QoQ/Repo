<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>樂透分析系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .result-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">樂透分析系統</h1>
        
        <!-- 快速選號推薦區域 -->
        <div class="card mb-4" id="recommendSection">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">快速選號推薦</h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center mb-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="recommendLotteryType" class="form-label">選擇樂透類型</label>
                            <select class="form-control" id="recommendLotteryType">
                                <option value="big_lotto">大樂透</option>
                                <option value="super_lotto">威力彩</option>
                                <option value="daily_cash">今彩539</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="recommendPeriods" class="form-label">分析期數</label>
                            <input type="number" class="form-control" id="recommendPeriods" 
                                   placeholder="留空分析所有資料">
                        </div>
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button class="btn btn-primary w-100" onclick="getRecommendation()">立即推薦</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-danger">熱門</span>
                            <span class="badge bg-primary">冷門</span>
                            <span class="badge bg-info">平衡</span>
                            <span class="text-muted ms-2">
                                根據歷史數據分析，為您推薦最佳選號組合
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 推薦結果將顯示在這裡 -->
            <div id="recommendationResult" style="display: none;"></div>
        </div>
        
        <!-- 新增：詳細分析區域 -->
        <div class="card mb-4" id="analysisSection">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">詳細數據分析</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="lotteryType">樂透類型</label>
                            <select class="form-control" id="lotteryType">
                                <option value="big_lotto">大樂透</option>
                                <option value="super_lotto">威力彩</option>
                                <option value="daily_cash">今彩539</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="analysisType">分析類型</label>
                            <select class="form-control" id="analysisType">
                                <option value="basic">基本統計</option>
                                <option value="interval">區間分析</option>
                                <option value="continuity">連續性分析</option>
                                <option value="time_series">時間序列分析</option>
                                <option value="prediction">預測分析</option>
                                <option value="combination">組合模式分析</option>
                                <option value="combination_prediction">號碼組合預測</option>
                                <option value="advanced_statistics">進階統計分析</option>
                                <option value="missing_value">遺漏值分析</option>
                                <option value="network">號碼關聯網絡分析</option>
                                <option value="probability">機率分布分析</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="periods">分析期數 (可選)</label>
                            <input type="number" class="form-control" id="periods" placeholder="留空分析所有資料">
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-info">統計</span>
                            <span class="badge bg-warning">預測</span>
                            <span class="badge bg-secondary">分析</span>
                            <span class="text-muted ms-2">
                                提供多維度的數據分析，協助您更好地理解開獎趨勢
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <button class="btn btn-success" onclick="analyze()">開始分析</button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">分析中，請稍候...</p>
        </div>
        
        <div id="dataRange" class="result-section"></div>
        <div id="result" class="result-section"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function updateDataRange() {
            const lotteryType = document.getElementById('lotteryType').value;
            fetch(`/data_range?lottery_type=${lotteryType}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('dataRange').innerHTML = `
                        <h4>資料範圍</h4>
                        <div class="alert alert-info">
                            <strong>最新一期：</strong> 第 ${data.latest_term} 期
                        </div>
                        <p>從 ${data.start_date} 到 ${data.end_date}</p>
                        <p>共 ${data.total_draws} 期</p>
                    `;
                });
        }

        function analyze() {
            const lotteryType = document.getElementById('lotteryType').value;
            const analysisType = document.getElementById('analysisType').value;
            const periods = document.getElementById('periods').value;
            
            showLoading();
            
            const data = {
                lottery_type: lotteryType,
                analysis_type: analysisType,
                periods: periods || null
            };
            
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                hideLoading();
                if (result.error) {
                    document.getElementById('result').innerHTML = `
                        <div class="alert alert-danger">分析過程發生錯誤: ${result.error}</div>
                    `;
                    return;
                }
                displayResult(result, analysisType);
            })
            .catch(error => {
                hideLoading();
                document.getElementById('result').innerHTML = `
                    <div class="alert alert-danger">分析過程發生錯誤: ${error}</div>
                `;
            });
        }

        function displayResult(result, analysisType) {
            let html = '<h4>分析結果</h4>';
            
            switch (analysisType) {
                case 'basic':
                    html += displayBasicStats(result);
                    break;
                case 'interval':
                    html += displayIntervalAnalysis(result);
                    break;
                case 'continuity':
                    html += displayContinuityAnalysis(result);
                    break;
                case 'time_series':
                    html += displayTimeSeriesAnalysis(result);
                    break;
                case 'prediction':
                    html += displayPredictionAnalysis(result);
                    break;
                case 'recommend':
                    html += displayRecommendation(result);
                    break;
                case 'combination':
                    html += displayCombinationAnalysis(result);
                    break;
                case 'combination_prediction':
                    html += displayCombinationPrediction(result);
                    break;
                case 'advanced_statistics':
                    html += displayAdvancedStatistics(result);
                    break;
                case 'missing_value':
                    html += displayMissingValueAnalysis(result);
                    break;
                case 'network':
                    html += displayNetworkAnalysis(result);
                    break;
                case 'probability':
                    html += displayProbabilityAnalysis(result);
                    break;
            }
            
            document.getElementById('result').innerHTML = html;
        }

        function displayBasicStats(result) {
            let html = '<div class="mt-3">';
            
            // 分析說明
            html += '<div class="card mb-4">';
            html += '<div class="card-header bg-light"><h5 class="mb-0">分析方法說明</h5></div>';
            html += '<div class="card-body">';
            html += '<div class="row">';
            
            // 熱門號碼說明
            html += '<div class="col-md-6 mb-3">';
            html += '<div class="card h-100 border-danger">';
            html += '<div class="card-header bg-danger text-white">熱門號碼分析</div>';
            html += '<div class="card-body">';
            html += '<p class="card-text">' + (result.analysis_description['熱門號碼分析'] || '').replace(/\n/g, '<br>') + '</p>';
            html += '</div></div></div>';
            
            // 低頻號碼說明
            html += '<div class="col-md-6 mb-3">';
            html += '<div class="card h-100 border-secondary">';
            html += '<div class="card-header bg-secondary text-white">低頻號碼分析</div>';
            html += '<div class="card-body">';
            html += '<p class="card-text">' + (result.analysis_description['低頻號碼分析'] || '').replace(/\n/g, '<br>') + '</p>';
            html += '</div></div></div>';
            
            // 遺漏號碼說明
            html += '<div class="col-md-6 mb-3">';
            html += '<div class="card h-100 border-primary">';
            html += '<div class="card-header bg-primary text-white">遺漏號碼分析</div>';
            html += '<div class="card-body">';
            html += '<p class="card-text">' + (result.analysis_description['遺漏號碼分析'] || '').replace(/\n/g, '<br>') + '</p>';
            html += '</div></div></div>';
            
            // 趨勢分析說明
            html += '<div class="col-md-6 mb-3">';
            html += '<div class="card h-100" style="border-color: #8B4513;">';
            html += '<div class="card-header text-white" style="background-color: #8B4513;">趨勢分析</div>';
            html += '<div class="card-body">';
            html += '<p class="card-text">' + (result.analysis_description['趨勢分析'] || '').replace(/\n/g, '<br>') + '</p>';
            html += '</div></div></div>';
            
            html += '</div></div></div>';
            
            // 基本統計摘要
            html += '<h5>基本統計摘要</h5>';
            html += '<div class="table-responsive"><table class="table table-striped">';
            html += `<tr><th>總開獎次數</th><td>${result.summary_stats.total_draws}期</td></tr>`;
            html += `<tr><th>號碼範圍</th><td>${result.summary_stats.min_number} - ${result.summary_stats.max_number}</td></tr>`;
            html += `<tr><th>最常開出號碼</th><td>${result.summary_stats.most_common_numbers}</td></tr>`;
            html += '</table></div>';
            
            // 熱門號碼分析
            html += '<h5 class="mt-4">熱門號碼分析</h5><div class="table-responsive"><table class="table table-striped">';
            html += '<thead><tr><th>號碼</th><th>出現頻率</th><th>出現率</th><th>最近開出</th><th>開出記錄</th></tr></thead><tbody>';
            result.hot_numbers.forEach(num => {
                html += `<tr>
                    <td><span class="badge bg-danger">${num.number}</span></td>
                    <td>${num.frequency}</td>
                    <td>${num.percentage}%</td>
                    <td>${num.last_appearance}</td>
                    <td><small>${num.recent_draws}</small></td>
                </tr>`;
            });
            html += '</tbody></table></div>';
            
            // 冷門號碼分析
            html += '<h5 class="mt-4">冷門號碼分析</h5>';
            
            // 低頻號碼
            html += '<h6 class="mt-3">低頻號碼（出現頻率低於平均值的80%）</h6>';
            html += '<div class="table-responsive"><table class="table table-striped">';
            html += '<thead><tr><th>號碼</th><th>總出現次數</th><th>最後開出</th><th>遺漏期數</th><th>歷史出現率</th></tr></thead><tbody>';
            result.cold_numbers
                .filter(num => num.cold_type === '低頻')
                .forEach(num => {
                    html += `<tr>
                        <td><span class="badge bg-secondary">${num.number}</span></td>
                        <td>${num.total_appearances}</td>
                        <td>${num.last_appearance}</td>
                        <td>${num.draws_since_last}</td>
                        <td>${num.historical_percentage}%</td>
                    </tr>`;
                });
            html += '</tbody></table></div>';
            
            // 遺漏號碼
            html += '<h6 class="mt-3">遺漏號碼（超過10期未開出）</h6>';
            html += '<div class="table-responsive"><table class="table table-striped">';
            html += '<thead><tr><th>號碼</th><th>總出現次數</th><th>最後開出</th><th>遺漏期數</th><th>歷史出現率</th></tr></thead><tbody>';
            result.cold_numbers
                .filter(num => num.cold_type === '遺漏')
                .forEach(num => {
                    html += `<tr>
                        <td><span class="badge bg-primary">${num.number}</span></td>
                        <td>${num.total_appearances}</td>
                        <td>${num.last_appearance}</td>
                        <td>${num.draws_since_last}</td>
                        <td>${num.historical_percentage}%</td>
                    </tr>`;
                });
            html += '</tbody></table></div>';
            
            return html + '</div>';
        }

        function displayIntervalAnalysis(result) {
            let html = '<div class="mt-3">';
            
            // 區間統計
            html += '<h5>號碼分區統計</h5><div class="table-responsive"><table class="table table-striped">';
            html += '<thead><tr><th>區間</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
            result.section_stats.forEach(section => {
                html += `<tr><td>${section.section_start}-${section.section_end}</td>
                        <td>${section.frequency}</td><td>${section.percentage}%</td></tr>`;
            });
            html += '</tbody></table></div>';
            
            // 大小比例
            html += '<h5 class="mt-4">大小號碼比例</h5><div class="table-responsive"><table class="table table-striped">';
            html += '<thead><tr><th>比例</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
            result.size_ratio.forEach(ratio => {
                html += `<tr><td>${ratio.ratio}</td><td>${ratio.frequency}</td><td>${ratio.percentage}%</td></tr>`;
            });
            html += '</tbody></table></div>';
            
            // 奇偶比例
            html += '<h5 class="mt-4">奇偶數比例</h5><div class="table-responsive"><table class="table table-striped">';
            html += '<thead><tr><th>比例</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
            result.odd_even_ratio.forEach(ratio => {
                html += `<tr><td>${ratio.ratio}</td><td>${ratio.frequency}</td><td>${ratio.percentage}%</td></tr>`;
            });
            html += '</tbody></table></div>';
            
            return html + '</div>';
        }

        function displayContinuityAnalysis(result) {
            let html = '<div class="mt-3">';
            
            // 連續號碼統計
            if (result.consecutive_stats && result.consecutive_stats.length > 0) {
                html += '<h5>連續號碼統計</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>連續數量</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
                result.consecutive_stats.forEach(stat => {
                    html += `<tr><td>${stat.consecutive_count}個連續號碼</td>
                            <td>${stat.frequency}</td><td>${stat.percentage}%</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            // 號碼間隔統計
            if (result.gap_stats && result.gap_stats.length > 0) {
                html += '<h5 class="mt-4">號碼間隔統計</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>間隔</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
                result.gap_stats.forEach(stat => {
                    html += `<tr><td>${stat.gap}</td><td>${stat.frequency}</td><td>${stat.percentage}%</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            // 個別號碼間隔分析
            if (result.number_gaps && result.number_gaps.length > 0) {
                html += '<h5 class="mt-4">個別號碼間隔分析</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>號碼</th><th>平均間隔</th><th>最短間隔</th><th>最長間隔</th></tr></thead><tbody>';
                result.number_gaps.forEach(stat => {
                    html += `<tr><td>${stat.number}</td><td>${stat.avg_gap}</td>
                            <td>${stat.min_gap}</td><td>${stat.max_gap}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            return html + '</div>';
        }

        function displayTimeSeriesAnalysis(result) {
            let html = '<div class="mt-3">';
            
            // 年度分析
            if (result.yearly_stats && result.yearly_stats.length > 0) {
                html += '<h5>年度分析</h5>';
                result.yearly_stats.forEach(stat => {
                    html += `<div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">${stat.year}年</h6>
                            <p>期數: ${stat.draw_count} 期</p>
                            <p>總開出號碼數: ${stat.total_numbers}</p>
                            <p>熱門號碼: ${stat.hot_numbers}</p>
                        </div>
                    </div>`;
                });
            }
            
            // 月份分析
            if (result.monthly_stats && result.monthly_stats.length > 0) {
                html += '<h5 class="mt-4">月份分析</h5>';
                result.monthly_stats.forEach(stat => {
                    html += `<div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">${stat.month}月</h6>
                            <p>期數: ${stat.draw_count} 期</p>
                            <p>總開出號碼數: ${stat.total_numbers}</p>
                            <p>常見號碼: ${stat.common_numbers}</p>
                        </div>
                    </div>`;
                });
            }
            
            // 星期分析
            if (result.weekday_stats && result.weekday_stats.length > 0) {
                const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
                html += '<h5 class="mt-4">星期分析</h5>';
                result.weekday_stats.forEach(stat => {
                    html += `<div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">星期${weekdays[stat.weekday]}</h6>
                            <p>期數: ${stat.draw_count} 期</p>
                            <p>總開出號碼數: ${stat.total_numbers}</p>
                            <p>常見號碼: ${stat.common_numbers}</p>
                        </div>
                    </div>`;
                });
            }
            
            // 季節分析
            if (result.seasonal_stats && result.seasonal_stats.length > 0) {
                html += '<h5 class="mt-4">季節分析</h5>';
                result.seasonal_stats.forEach(stat => {
                    html += `<div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">${stat.season}</h6>
                            <p>期數: ${stat.draw_count} 期</p>
                            <p>總開出號碼數: ${stat.total_numbers}</p>
                            <p>常見號碼: ${stat.common_numbers}</p>
                        </div>
                    </div>`;
                });
            }
            
            return html + '</div>';
        }

        function displayPredictionAnalysis(result) {
            let html = '<div class="mt-3">';
            
            // 近期熱門號碼
            if (result.hot_numbers && result.hot_numbers.length > 0) {
                html += '<h5>近期熱門號碼</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>號碼</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
                result.hot_numbers.forEach(num => {
                    html += `<tr><td>${num.number}</td><td>${num.frequency}</td><td>${num.percentage}%</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            // 近期冷門號碼
            if (result.cold_numbers && result.cold_numbers.length > 0) {
                html += '<h5 class="mt-4">近期冷門號碼</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>號碼</th><th>最後出現日期</th><th>間隔天數</th><th>總出現次數</th></tr></thead><tbody>';
                result.cold_numbers.forEach(num => {
                    html += `<tr><td>${num.number}</td><td>${num.last_date}</td>
                            <td>${num.days_since_last}</td><td>${num.total_appearances}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            // 號碼趨勢
            if (result.number_trends && result.number_trends.length > 0) {
                html += '<h5 class="mt-4">號碼趨勢分析</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>號碼</th><th>趨勢</th><th>平均出現</th><th>出現範圍</th></tr></thead><tbody>';
                result.number_trends.forEach(trend => {
                    html += `<tr><td>${trend.number}</td><td>${trend.trend}</td>
                            <td>${trend.avg_frequency.toFixed(1)}次</td>
                            <td>${trend.min_frequency}-${trend.max_frequency}次</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            // 號碼模式
            if (result.pattern_numbers && result.pattern_numbers.length > 0) {
                html += '<h5 class="mt-4">常見號碼模式</h5><div class="table-responsive"><table class="table table-striped">';
                html += '<thead><tr><th>大小比例</th><th>奇偶比例</th><th>區間分布</th><th>出現次數</th><th>百分比</th></tr></thead><tbody>';
                result.pattern_numbers.forEach(pattern => {
                    html += `<tr><td>${pattern.size_pattern}</td><td>${pattern.odd_even_pattern}</td>
                            <td>${pattern.section_pattern}</td><td>${pattern.frequency}</td>
                            <td>${pattern.percentage}%</td></tr>`;
                });
                html += '</tbody></table></div>';
            }
            
            return html + '</div>';
        }

        function displayRecommendation(result) {
            let html = '<div class="card">';
            
            // 分析說明
            html += '<div class="card-header bg-primary text-white">選號推薦</div>';
            html += '<div class="card-body">';
            html += '<div class="mb-4"><h6>推薦說明：</h6>';
            html += '<div class="card-text">';
            for (let key in result.analysis_description) {
                html += `<div class="mb-3">`;
                html += `<strong class="d-block mb-2">${key}：</strong>`;
                html += `<p class="ms-3">${(result.analysis_description[key] || '').replace(/\n/g, '<br>')}</p>`;
                html += `</div>`;
            }
            html += '</div></div>';
            
            // 修改推薦號碼顯示部分
            html += '<div class="row">';
            
            // 平衡型
            html += '<div class="col-md-4">';
            html += '<div class="card mb-3">';
            html += '<div class="card-header bg-info text-white">平衡型選號</div>';
            html += '<div class="card-body">';
            html += '<div class="alert alert-info mb-3">適合一般玩家，平衡熱門與冷門號碼</div>';
            result.balanced_numbers.forEach((numbers, index) => {
                html += '<div class="mb-4 p-2 border rounded">';
                html += `<h5 class="text-center text-muted">第 ${index + 1} 組</h5>`;
                html += '<div class="d-flex justify-content-center">';
                numbers.forEach(num => {
                    html += `<span class="badge bg-info mx-1" style="font-size: 1.2em;">${num}</span>`;
                });
                html += '</div>';
                html += '</div>';
            });
            html += '<div class="text-center mt-2">';
            html += '<span class="badge bg-danger me-2">3個熱門號碼</span>';
            html += '<span class="badge bg-primary">3個冷門號碼</span>';
            html += '</div>';
            html += '</div></div></div>';
            
            // 進取型
            html += '<div class="col-md-4">';
            html += '<div class="card mb-3">';
            html += '<div class="card-header bg-success text-white">進取型選號</div>';
            html += '<div class="card-body">';
            html += '<div class="alert alert-success mb-3">追求高命中率，偏好熱門號碼</div>';
            result.aggressive_numbers.forEach((numbers, index) => {
                html += '<div class="mb-4 p-2 border rounded">';
                html += `<h5 class="text-center text-muted">第 ${index + 1} 組</h5>`;
                html += '<div class="d-flex justify-content-center">';
                numbers.forEach(num => {
                    html += `<span class="badge bg-success mx-1" style="font-size: 1.2em;">${num}</span>`;
                });
                html += '</div>';
                html += '</div>';
            });
            html += '<div class="text-center mt-2">';
            html += '<span class="badge bg-danger me-2">4個熱門號碼</span>';
            html += '<span class="badge bg-primary">2個冷門號碼</span>';
            html += '</div>';
            html += '</div></div></div>';
            
            // 保守型
            html += '<div class="col-md-4">';
            html += '<div class="card mb-3">';
            html += '<div class="card-header bg-warning">保守型選號</div>';
            html += '<div class="card-body">';
            html += '<div class="alert alert-warning mb-3">期待遺漏值回補，偏好冷門號碼</div>';
            result.conservative_numbers.forEach((numbers, index) => {
                html += '<div class="mb-4 p-2 border rounded">';
                html += `<h5 class="text-center text-muted">第 ${index + 1} 組</h5>`;
                html += '<div class="d-flex justify-content-center">';
                numbers.forEach(num => {
                    html += `<span class="badge bg-warning mx-1" style="font-size: 1.2em;">${num}</span>`;
                });
                html += '</div>';
                html += '</div>';
            });
            html += '<div class="text-center mt-2">';
            html += '<span class="badge bg-danger me-2">2個熱門號碼</span>';
            html += '<span class="badge bg-primary">4個冷門號碼</span>';
            html += '</div>';
            html += '</div></div></div>';
            
            html += '</div>';  // row end
            
            // 號碼分析詳情
            html += '<div class="mt-4">';
            html += '<h6>號碼分析詳情：</h6>';
            html += '<div class="table-responsive"><table class="table table-sm table-striped">';
            html += '<thead><tr><th>號碼</th><th>頻率</th><th>最後開出</th><th>遺漏期數</th><th>命中率</th><th>類型</th><th>推薦分數</th></tr></thead><tbody>';
            result.number_analysis.forEach(num => {
                let typeClass = num.number_type === 'H' ? 'text-danger' : 'text-primary';
                html += `<tr>
                    <td>${num.number}</td>
                    <td>${num.frequency}</td>
                    <td>${num.last_appearance}</td>
                    <td>${num.missing_draws}</td>
                    <td>${num.hit_rate}%</td>
                    <td class="${typeClass}">${num.number_type === 'H' ? '熱門' : '冷門'}</td>
                    <td>${num.recommendation_score}</td>
                </tr>`;
            });
            html += '</tbody></table></div>';
            html += '</div>';
            
            html += '</div></div>';
            
            document.getElementById('recommendationResult').style.display = 'block';
            document.getElementById('recommendationResult').innerHTML = html;
        }

        function getRecommendation() {
            const lotteryType = document.getElementById('recommendLotteryType').value;
            const periods = document.getElementById('recommendPeriods').value;
            
            showLoading();
            
            fetch('/recommend_from_hot_cold', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    lottery_type: lotteryType,
                    periods: periods || null
                })
            })
            .then(response => response.json())
            .then(result => {
                hideLoading();
                displayRecommendation(result);
            })
            .catch(error => {
                hideLoading();
                document.getElementById('recommendationResult').innerHTML = `
                    <div class="alert alert-danger">推薦過程發生錯誤: ${error}</div>
                `;
            });
        }

        // 頁面載入時更新資料範圍
        document.addEventListener('DOMContentLoaded', updateDataRange);
        document.getElementById('lotteryType').addEventListener('change', updateDataRange);
    </script>
</body>
</html> 